(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{"0x5P":function(t,e,i){"use strict";i.d(e,"a",(function(){return r}));var c=i("tk/3"),n=i("LRne"),s=i("JIr8"),a=i("AytR"),o=i("fXoL");let r=(()=>{class t{constructor(t){this.http=t,this.URL_API=a.a.apiUrl+"/Vehicle",this.HttpOptions={headers:new c.c({"Content-Type":"application/json"})}}getBrands(){return this.http.get(this.URL_API+"/GetBrands")}getVehicleTypes(){return this.http.get(this.URL_API+"/GetVehicleType")}getVehicleStates(){return this.http.get(this.URL_API+"/GetVehicleStates")}getVehicleModelByBrandAndType(t,e){return this.http.get(`${this.URL_API}/GetVehicleModelByBrandAndType?pId_brand=${t}&pId_VehicleType=${e}`)}async getVehicleModelByTypes(t){let e="";return t.forEach(t=>e+=t.id+","),e=e.substr(0,e.length-1),this.http.get(`${this.URL_API}/GetVehicleModelsByTypes?sLsTypes=${e}`).toPromise()}async getVehiclesByClient(t){return this.http.get(`${this.URL_API}/GetVehiclesByClient?pClient_id=${t}`).toPromise()}getVehiclesByClientAndModel(t,e,i=0){return this.http.get(`${this.URL_API}/GetVehiclesByClientAndModel?pClient_id=${t}&sModels=${e}&contract_id=${i}`)}Insert(t){return this.http.post(this.URL_API+"/Insert",t,this.HttpOptions)}Update(t){return this.http.put(this.URL_API+"/Update",t,this.HttpOptions)}Delete(t){return this.http.delete(`${this.URL_API}/Delete?vehicleId=${t.id}`,this.HttpOptions)}getVehiclesByLicensePlate(t){return t.trim()?this.http.get(`${this.URL_API}/GetVehiclesByLicensePlate?pLicensePlate=${t}`).pipe(Object(s.a)(this.handleError("getVehiclesByLicensePlate",[]))):Object(n.a)([])}setListVehicleTypeSelected(t){this.lsVehicleTypeSelected=t}getListVehicleTypeSelected(){return this.lsVehicleTypeSelected}setVehicleModelSelected(t){this.vehicleModelSelected=t}getVehicleModelSelected(){return this.vehicleModelSelected}setVehicleStateSelected(t){this.vehicleState=t}getVehicleStateSelected(){return this.vehicleState}setVehicle(t){this.vehicle=t}getVehicle(){return this.vehicle}setVehicleToUpdate(t){this.vehicleToUpdate=t}getVehicleToUpdate(){return this.vehicleToUpdate}setBrandSelected(t){this.brandSelected=t}getBrandSelected(){return this.brandSelected}setVehicleTypeSelected(t){this.vehicleTypeSelected=t}getVehicleTypeSelected(){return this.vehicleTypeSelected}getListVehicleModelsSelected(){return this.lsVehicleModelsSelected}setListVehicleModelsSelected(t){this.lsVehicleModelsSelected=t}getListVehiclesSelected(){return this.lsVehiclesSelected}setListVehiclesSelected(t){this.lsVehiclesSelected=t}handleError(t="operation",e){return t=>(console.error(t),Object(n.a)(e))}}return t.\u0275fac=function(e){return new(e||t)(o.fc(c.a))},t.\u0275prov=o.Rb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},"1W2K":function(t,e,i){"use strict";function c(t,e){window.sessionStorage.setItem(t,e)}function n(t){return window.sessionStorage.getItem(t)}i.d(e,"b",(function(){return c})),i.d(e,"a",(function(){return n}))},"7I7t":function(t,e,i){"use strict";i.d(e,"a",(function(){return s}));var c=i("930R");class n{}class s{constructor(){}static validateUserAndCompany(){try{const t=new n,e=JSON.parse(sessionStorage.getItem("sessionUser"));return console.log(e),t.type=e.company.type,t.id=e.company.type==c.a.DEALER||e.company.type==c.a.CLIENT?e.company.id:0,t.usr_id=e.id_user,t}catch(t){console.warn(t)}}static validateUserLogged(){try{return JSON.parse(sessionStorage.getItem("sessionUser")).id_user}catch(t){console.warn(t)}}}},"930R":function(t,e,i){"use strict";i.d(e,"a",(function(){return c}));var c=function(t){return t[t.MAIN_COMPANY=1]="MAIN_COMPANY",t[t.CLIENT=2]="CLIENT",t[t.DEALER=3]="DEALER",t}({})},FGSN:function(t,e,i){"use strict";i.d(e,"a",(function(){return c}));var c=function(t){return t[t.CREATE=1]="CREATE",t[t.READ=2]="READ",t[t.UPDATE=3]="UPDATE",t[t.DELETE=4]="DELETE",t}({})},KBxE:function(t,e,i){"use strict";i.d(e,"a",(function(){return n}));var c=i("fXoL");let n=(()=>{class t{constructor(){this.title="",this.errorMessage="",this.onAlertWasClose=new c.q}set setTitle(t){this.title=t}set setErrorMessage(t){this.errorMessage=t}ngOnInit(){}closeAlert(){this.onAlertWasClose.emit(!0)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=c.Pb({type:t,selectors:[["app-alert-error"]],inputs:{setTitle:["title","setTitle"],setErrorMessage:["errorMessage","setErrorMessage"]},outputs:{onAlertWasClose:"onAlertWasClose"},decls:15,vars:2,consts:[[1,"item-overlay"],[1,"card"],["id","container__header",1,"card-header"],[1,"buttonClose",3,"click"],[1,"fas","fa-times"],[1,"card-body"],[1,"container-error"],["width","100px","height","100px","src","assets/error.png","alt","error"],[1,"error-description"]],template:function(t,e){1&t&&(c.bc(0,"div",0),c.bc(1,"div",1),c.bc(2,"div",2),c.bc(3,"a",3),c.ic("click",(function(){return e.closeAlert()})),c.Wb(4,"i",4),c.ac(),c.ac(),c.bc(5,"div",5),c.bc(6,"div",6),c.Wb(7,"img",7),c.bc(8,"div",8),c.bc(9,"h2"),c.Mc(10),c.ac(),c.bc(11,"p"),c.bc(12,"b"),c.Mc(13,"Detalle: "),c.ac(),c.Mc(14),c.ac(),c.ac(),c.ac(),c.ac(),c.ac(),c.ac()),2&t&&(c.Jb(10),c.Nc(e.title),c.Jb(4),c.Nc(e.errorMessage))},styles:[".card[_ngcontent-%COMP%]{position:relative;width:650px;margin:10px}.card-body[_ngcontent-%COMP%]{padding:10px}.container-error[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;padding:10px}.error-description[_ngcontent-%COMP%]{position:relative;max-width:450px;left:30px}#container__header[_ngcontent-%COMP%]{display:flex;flex-direction:row;direction:rtl}.item-overlay[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3fr);grid-template-rows:repeat(3fr);position:fixed;left:0;right:0;top:0;bottom:0;background-color:rgba(6,129,230,.1);border-radius:15px;align-items:center;justify-items:center;z-index:5000;width:100%;height:100%}"]}),t})()},PwQI:function(t,e,i){"use strict";i.r(e),i.d(e,"ContractModule",(function(){return St}));var c=i("ofXK"),n=i("3Pt+"),s=i("wZkO"),a=i("hzby"),o=i("Z/wE"),r=i("tyNb"),l=i("uswQ"),d=i("fXoL"),h=i("FGSN"),u=i("930R"),b=i("cRgG"),p=i("us/p"),g=i("2fpb"),m=i("7I7t"),f=i("p9j/"),C=i("1W2K"),v=i("PSD3"),M=i.n(v),S=i("i5Qh"),y=i("FMJ1"),I=i("2jix"),T=i("Rw4P"),_=i("ZyAM"),D=i("wAkH");function P(t,e){if(1&t&&(d.bc(0,"option",4),d.Mc(1),d.nc(2,"lowercase"),d.ac()),2&t){const t=e.$implicit;d.uc("value",t.id),d.Jb(1),d.Oc(" ",d.oc(2,2,t.name)," ")}}let V=(()=>{class t{constructor(t,e){this.contractService=t,this.contracStateService=e,this.discountWasSelected=new d.q,this.frmDiscountType=new n.j({cmbDiscount:new n.g("Seleccione ...")}),this.contracStateService.discountType$.subscribe(t=>{this.discountSelected=t,this.discountSelected?this.setDataInForm(this.discountSelected):this.frmDiscountType.reset()}),this.disableField=!1}set setDiscountSelected(t){this.discountSelected=t,this.discountSelected?this.setDataInForm(this.discountSelected):this.frmDiscountType.reset()}ngOnChanges(t){for(const e in t)"countChanges"==e?(this.discountSelected=this.contractService.getDiscountTypeSelected(),null!=this.discountSelected&&null!=this.discountSelected&&(this.setDataInForm(this.discountSelected),this.discountWasSelected.emit(this.discountSelected))):"disableField"==e&&this.toggleDisableDiscountFiled()}ngOnInit(){this.initComponents()}async initComponents(){try{this.countChanges=0,this.lsDiscount=await this.contractService.getDiscountTypes()}catch(t){console.error(t)}}setDiscountType(t){const e=this.lsDiscount.find(e=>e.id==t.value);this.discountSelected=e,this.contractService.setDiscountTypeSelected(e),this.discountWasSelected.emit(this.discountSelected)}setDataInForm(t){const{cmbDiscount:e}=this.frmDiscountType.controls;e.setValue(t.id)}lostFocus(){this.discountWasSelected.emit(this.discountSelected)}toggleDisableDiscountFiled(){const{cmbDiscount:t}=this.frmDiscountType.controls;this.disableField?t.disable():t.enable()}}return t.\u0275fac=function(e){return new(e||t)(d.Vb(I.a),d.Vb(T.a))},t.\u0275cmp=d.Pb({type:t,selectors:[["app-contract-discount-type"]],inputs:{countChanges:"countChanges",disableField:"disableField",setDiscountSelected:["discountType","setDiscountSelected"]},outputs:{discountWasSelected:"discountWasSelected"},features:[d.Hb],decls:7,vars:3,consts:[[3,"formGroup"],["formControlName","cmbDiscount",1,"browser-default","custom-select",3,"change","focusout"],["disabled","",3,"value"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(t,e){1&t&&(d.bc(0,"form",0),d.bc(1,"label"),d.Mc(2,"Tipo de descuento:"),d.ac(),d.bc(3,"select",1),d.ic("change",(function(t){return e.setDiscountType(t.target)}))("focusout",(function(){return e.lostFocus()})),d.bc(4,"option",2),d.Mc(5,"Seleccione ..."),d.ac(),d.Lc(6,P,3,4,"option",3),d.ac(),d.ac()),2&t&&(d.uc("formGroup",e.frmDiscountType),d.Jb(4),d.uc("value",0),d.Jb(2),d.uc("ngForOf",e.lsDiscount))},directives:[n.B,n.r,n.k,n.x,n.q,n.i,n.u,n.A,c.n],pipes:[c.l],styles:["select[_ngcontent-%COMP%]{cursor:pointer}"]}),t})();var x=i("xRBo"),O=i("2Vo4"),w=i("0x5P"),A=i("MAxM");function F(t,e){1&t&&(d.bc(0,"div",4),d.bc(1,"H6"),d.Mc(2,"* Recuerde que si no aparece ninguna placa del cliente puede ser debido a que estas tienen un estado inactivo \xf3 ya est\xe1n asociadas a un contrato con estado activo *"),d.ac(),d.ac())}function E(t,e){if(1&t){const t=d.cc();d.bc(0,"tr"),d.bc(1,"td"),d.Mc(2),d.ac(),d.bc(3,"td"),d.bc(4,"div",5),d.bc(5,"app-input-checkbox",6),d.ic("onCheckItem",(function(i){d.Dc(t);const c=e.$implicit;return d.mc().setVehicleToContract(i,c.vehicle)})),d.ac(),d.ac(),d.ac(),d.bc(6,"td"),d.Mc(7),d.ac(),d.bc(8,"td"),d.Mc(9),d.ac(),d.bc(10,"td"),d.Mc(11),d.ac(),d.Wb(12,"td"),d.ac()}if(2&t){const t=e.$implicit,i=e.index,c=d.mc();d.Jb(2),d.Nc(i+1),d.Jb(3),d.uc("option",t.vehicle.licensePlate)("isActive",t.status)("disable",c.disableChecks),d.Jb(2),d.Nc(t.vehicle.vehicleModel.shortName),d.Jb(2),d.Nc(t.vehicle.mileage),d.Jb(2),d.Nc(t.vehicle.vehicleState.name)}}let L=(()=>{class t{constructor(t,e){this.vehicleService=t,this.contractStateService=e,this.lsVehiclesSelected=[],this.lsVehicles=[],this.vehiclesObserver=new O.a([]),this.vehicles$=this.vehiclesObserver.asObservable(),this.clientToFilter=void 0,this._vehicleModels=[],this._amountAllowed=0,this.contractToFilter=void 0,this.disableChecks=!1,this.clientToFilter=null,this.sModels="",this.disableChecks=!1,this.contractStateService.client$.subscribe(t=>{this.clientToFilter=t}),this.vehicles$.subscribe(t=>{this.lsVehicles=t}),this.contractStateService.vehicleModel$.subscribe(t=>{try{this.setModelsString(t),this.getVehicles()}catch(e){console.info(e)}})}set setClientToFilter(t){this.clientToFilter=t}set setVehicleModels(t){this._vehicleModels=t,console.log("Models to filter"),console.log(this._vehicleModels),this.setModelsString(this._vehicleModels),this.getVehicles()}set setAmountAllowed(t){this._amountAllowed=t}set setContractToFilter(t){this.contractToFilter=t}set setDisableChecks(t){this.disableChecks=t}updateVehiclesSelected(){this.contractStateService.vehicles$.subscribe(t=>{this.lsVehiclesSelected=t,this.lsVehiclesSelected.forEach(t=>{this.updateVehicleStatus(t,!0)})})}ngOnInit(){this.initComponents()}initComponents(){this.getVehicles()}setModelsString(t){try{this.sModels="",null!=t&&null!=t&&(t.forEach(t=>this.sModels+=t.id+","),this.sModels=this.sModels.substring(0,this.sModels.length-1),""==this.sModels&&(this.sModels="0"))}catch(e){console.warn(e)}}getVehicles(){null!=this.clientToFilter&&null!=this.clientToFilter&&""!=this.sModels?this.vehicleService.getVehiclesByClientAndModel(this.clientToFilter.id,this.sModels,null!=this.contractToFilter&&null!=this.contractToFilter?this.contractToFilter.id:0).subscribe({next:t=>{if(t.length>0){let e=t.map(t=>({vehicle:t,status:!1}));this.vehiclesObserver.next(e),this.updateVehiclesSelected()}}}):this.lsVehicles=[]}setVehicleToContract(t,e){t?this.contractStateService.addVehicleToList(e):this.contractStateService.removeVehicleFromList(e)}updateVehicleStatus(t,e){try{const i=this.lsVehicles,c=i.findIndex(e=>t.id==e.vehicle.id);c>=0&&(i[c].status=e),this.vehiclesObserver.next(i)}catch(i){console.info(i)}}}return t.\u0275fac=function(e){return new(e||t)(d.Vb(w.a),d.Vb(T.a))},t.\u0275cmp=d.Pb({type:t,selectors:[["app-tbl-check-vehicles"]],inputs:{setClientToFilter:["clientToFilter","setClientToFilter"],setVehicleModels:["vehicleModels","setVehicleModels"],setAmountAllowed:["amountAllowed","setAmountAllowed"],setContractToFilter:["contractToFilter","setContractToFilter"],setDisableChecks:["disableChecks","setDisableChecks"]},decls:18,vars:2,consts:[[1,"container__table"],["class","alert alert-warning","role","alert",4,"ngIf"],[1,"table","table-striped"],[4,"ngFor","ngForOf"],["role","alert",1,"alert","alert-warning"],[1,"container_licensePlate"],[3,"option","isActive","disable","onCheckItem"]],template:function(t,e){1&t&&(d.bc(0,"div",0),d.Lc(1,F,3,0,"div",1),d.bc(2,"table",2),d.bc(3,"thead"),d.bc(4,"th"),d.Mc(5,"#"),d.ac(),d.bc(6,"th"),d.Mc(7,"Placa"),d.ac(),d.bc(8,"th"),d.Mc(9,"Modelo"),d.ac(),d.bc(10,"th"),d.Mc(11,"Kilometraje"),d.ac(),d.bc(12,"th"),d.Mc(13,"Estado"),d.ac(),d.bc(14,"th"),d.Mc(15,"Acciones"),d.ac(),d.ac(),d.bc(16,"tbody"),d.Lc(17,E,13,7,"tr",3),d.ac(),d.ac(),d.ac()),2&t&&(d.Jb(1),d.uc("ngIf",e.lsVehiclesEmty),d.Jb(16),d.uc("ngForOf",e.lsVehicles))},directives:[c.o,c.n,A.a],styles:[".container__table[_ngcontent-%COMP%]{margin-top:20px}.container_licensePlate[_ngcontent-%COMP%]{margin-top:-10px}.container__licensePlate[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{cursor:pointer}h6[_ngcontent-%COMP%]{margin-top:20px;margin-bottom:20px}",'.container__checkbox[_ngcontent-%COMP%]{display:block;position:relative;padding-left:3px;padding-right:3px;margin-bottom:12px;cursor:pointer;font-size:22px;-webkit-user-select:none;user-select:none}.container__checkbox[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{position:absolute;opacity:0;cursor:pointer;height:0;width:0}.checkmark[_ngcontent-%COMP%]{position:absolute;top:0;left:0;height:20px;width:20px;background-color:#eee;border:1px solid #686d76;border-radius:5px}.container__checkbox[_ngcontent-%COMP%]:hover   input[_ngcontent-%COMP%] ~ .checkmark[_ngcontent-%COMP%]{background-color:#ccc}.container__checkbox[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked ~ .checkmark[_ngcontent-%COMP%]{background-color:#81b214;border-radius:50%;border:none}.checkmark[_ngcontent-%COMP%]:after{content:"";position:absolute;display:none}.container__checkbox[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked ~ .checkmark[_ngcontent-%COMP%]:after{display:block}.container__checkbox[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:disabled ~ .checkmark[_ngcontent-%COMP%]{border:1px solid #686d76;border-radius:5px}.container__checkbox[_ngcontent-%COMP%]   .checkmark[_ngcontent-%COMP%]:after{left:8px;top:5px;width:5px;height:10px;border:solid #fff;border-width:0 2px 2px 0;transform:rotate(45deg)}']}),t})();class k{}var U=i("R7St"),R=i("xch/"),B=i("vllv"),J=i("oOf3"),N=i("9Wwi");function $(t,e){1&t&&(d.bc(0,"th"),d.Mc(1,"Valor del descuento"),d.ac())}function W(t,e){if(1&t){const t=d.cc();d.bc(0,"td"),d.bc(1,"input",10),d.ic("blur",(function(e){d.Dc(t);const i=d.mc().$implicit;return d.mc().savePersonalized(e,i)})),d.ac(),d.ac()}if(2&t){const t=d.mc().$implicit,e=d.mc();d.Jb(1),d.uc("value",e.getValueDiscount(t))}}function G(t,e){if(1&t&&(d.bc(0,"tr"),d.Lc(1,W,2,1,"td",4),d.bc(2,"td"),d.Mc(3),d.ac(),d.bc(4,"td"),d.Mc(5),d.ac(),d.bc(6,"td"),d.Mc(7),d.nc(8,"slice"),d.nc(9,"titlecase"),d.ac(),d.bc(10,"td"),d.Mc(11),d.nc(12,"titlecase"),d.ac(),d.bc(13,"td"),d.Mc(14),d.nc(15,"currency"),d.ac(),d.bc(16,"td"),d.Mc(17),d.nc(18,"currency"),d.ac(),d.bc(19,"td"),d.Mc(20),d.nc(21,"currency"),d.ac(),d.bc(22,"td"),d.Mc(23),d.nc(24,"currency"),d.ac(),d.bc(25,"td"),d.Mc(26),d.nc(27,"currency"),d.ac(),d.ac()),2&t){const t=e.index,i=e.$implicit,c=d.mc();d.Jb(1),d.uc("ngIf",c.isCheckboxVisible),d.Jb(2),d.Nc(t+1),d.Jb(2),d.Nc(i.code),d.Jb(2),d.Nc(d.qc(8,10,d.oc(9,14,i.name),0,40)),d.Jb(4),d.Nc(d.oc(12,16,i.presentationUnit.longName)),d.Jb(3),d.Nc(d.oc(15,18,i.referencePrice)),d.Jb(3),d.Nc(d.oc(18,20,i.discountValue)),d.Jb(3),d.Nc(d.oc(21,22,i.referencePrice-i.discountValue)),d.Jb(3),d.Nc(d.oc(24,24,i.taxesValue)),d.Jb(3),d.Oc(" ",d.oc(27,26,i.referencePrice-i.discountValue+i.taxesValue)," ")}}function j(t,e){1&t&&d.Wb(0,"app-img-loading")}const q=function(t){return{itemsPerPage:10,currentPage:t}};let z=(()=>{class t{constructor(t,e,i,c){this.maintenanceItemService=t,this.contractService=e,this.contracStateService=i,this.maintenanceItemManagerService=c,this.isCheckboxVisible=!1,this.lsMaintenanceItemsWasSetted=new d.q,this.maintencesItemsPersonalized=[],this.dealer=void 0,this.discountType=void 0,this.discountValue=0,this.p=1,this.lsMaintenanceItems=[],this.pricesByDealer=new k,this.pricesByDealer.lsMaintenanceItems=[],this.discountValue=0,this.discountType=new g.a,this.sharedFunction=new U.a,this.lsMaintenanceItemsWithPrice=[],this.contracStateService.dealer$.subscribe(t=>{this.dealer=t,t&&this.getInfoToShowTable()}),this.contracStateService.discountType$.subscribe(t=>{this.discountType=t,this.isCheckboxVisible=(null==t?void 0:t.id)===g.b.PORCENTAJE_POR_REPUESTOS||(null==t?void 0:t.id)===g.b.VALOR_FIJO_POR_REPUESTOS,this.getTypeDiscount(),this.calculateDiscountAndTaxes()}),this.contracStateService.discountValue$.subscribe(t=>{this.discountValue=t,this.calculateDiscountAndTaxes()})}ngOnInit(){this.initComponents()}initComponents(){this.getPricesOfContract=0,this.changeDealer=0,this.isAwaiting=!1,this.dealerSelected=this.dealer,this.dealerSelected&&this.getInfoToShowTable()}getInfoToShowTable(){this.getListMaintenanceItems(),this.getPricesByDealer(),this.getPricesByContract()}getListMaintenanceItems(){try{this.isAwaiting=!0,this.maintenanceItemService.getMaintenanceItems(null!=this.dealerSelected?this.dealerSelected.id:0).subscribe(t=>{this.lsMaintenanceItems=t}),this.isAwaiting=!1}catch(t){console.warn(t)}}getPricesByDealer(){var t,e;try{this.dealerSelected=this.dealer,this.isAwaiting=!0;const i=null!==(e=null===(t=this.dealerSelected)||void 0===t?void 0:t.id)&&void 0!==e?e:0;this.maintenanceItemService.getPricesByDealer(i).subscribe(t=>{this.pricesByDealer=t,this.lsMaintenanceItems=this.maintenanceItemManagerService.updatePrices(this.lsMaintenanceItems,this.pricesByDealer.lsMaintenanceItems),this.calculateDiscountAndTaxes(),this.isAwaiting=!1})}catch(i){console.warn(i)}}getPricesByContract(){var t,e;try{this.contractSelected=this.contractService.getContract();const i=null!==(e=null===(t=this.contractSelected)||void 0===t?void 0:t.id)&&void 0!==e?e:0;0!=i&&(this.isAwaiting=!0,this.maintenanceItemService.getPricesByContract(i).subscribe(t=>{this.pricesByContract=t,this.maintenanceItemManagerService.updatePrices(this.lsMaintenanceItems,this.pricesByContract.lsMaintenanceItems),this.calculateDiscountAndTaxes(),this.isAwaiting=!1}))}catch(i){console.warn(i)}}calculateDiscount(t){t.amount=1;let e=0;this.discountType&&(e=this.discountType.id==g.b.PORCENTAJE_POR__TOTAL_MANTENIMIENTO||this.discountType.id==g.b.PORCENTAJE_POR_REPUESTOS?this.calculateDiscountPerPercentage(t.referencePrice,this.isCheckboxVisible?this.getValueDiscount(t):this.discountValue):this.isCheckboxVisible?this.getValueDiscount(t):this.discountValue);const i=this.maintenanceItemManagerService.calculateTaxesByItem(t,t.referencePrice-e);return{id:t.id,code:t.code,name:t.name,presentationUnit:{longName:t.presentationUnit.longName},handleTax:t.handleTax,lsTaxes:t.lsTaxes,referencePrice:t.referencePrice,discountValue:e,taxesValue:i,valueDiscount:t.valueDiscount}}getValueDiscount(t){var e;return null!==(e=t.valueDiscount)&&void 0!==e?e:0}getTypeDiscount(){var t,e;return(null===(t=this.discountType)||void 0===t?void 0:t.id)===g.b.PORCENTAJE_POR_REPUESTOS||(null===(e=this.discountType)||void 0===e?void 0:e.id)===g.b.PORCENTAJE_POR__TOTAL_MANTENIMIENTO?"Descuento por porcentaje":"Descuento por valor fijo"}calculateDiscountPerPercentage(t,e){return Math.round(t*(e/100))}calculateDiscountAndTaxes(){this.lsMaintenanceItems=this.lsMaintenanceItems.map(t=>this.calculateDiscount(t)),this.contracStateService.setMaintenanceItems(this.lsMaintenanceItems)}savePersonalized(t,e){const i=+t.target.value,c=this.lsMaintenanceItems.findIndex(t=>t.id===e.id);e.valueDiscount=i,this.lsMaintenanceItems[c]=this.calculateDiscount(e)}}return t.\u0275fac=function(e){return new(e||t)(d.Vb(R.a),d.Vb(I.a),d.Vb(T.a),d.Vb(B.a))},t.\u0275cmp=d.Pb({type:t,selectors:[["app-tbl-prices-by-contract"]],inputs:{getPricesOfContract:"getPricesOfContract",changeDealer:"changeDealer"},outputs:{lsMaintenanceItemsWasSetted:"lsMaintenanceItemsWasSetted"},decls:34,vars:12,consts:[["id","container__table_items",1,"container__table"],[1,"text-right","mb-3"],[1,"alert","alert-primary"],[1,"table","table-striped"],[4,"ngIf"],[1,"col-number","col-mobile-hide"],[1,"col-mobile-hide"],[4,"ngFor","ngForOf"],[1,"paginationContainer"],[3,"pageChange"],["type","text",1,"form-control",3,"value","blur"]],template:function(t,e){1&t&&(d.bc(0,"div",0),d.bc(1,"h2"),d.Mc(2),d.nc(3,"titlecase"),d.ac(),d.bc(4,"div",1),d.bc(5,"span",2),d.Mc(6),d.ac(),d.ac(),d.bc(7,"table",3),d.bc(8,"thead"),d.Lc(9,$,2,0,"th",4),d.bc(10,"th",5),d.Mc(11,"#"),d.ac(),d.bc(12,"th"),d.Mc(13,"C\xf3digo"),d.ac(),d.bc(14,"th"),d.Mc(15,"Nombre"),d.ac(),d.bc(16,"th",6),d.Mc(17,"Presentaci\xf3n"),d.ac(),d.bc(18,"th",6),d.Mc(19,"Valor sin impuestos del concesionario"),d.ac(),d.bc(20,"th"),d.Mc(21,"Descuento"),d.ac(),d.bc(22,"th"),d.Mc(23,"Valor sin descuento"),d.ac(),d.bc(24,"th"),d.Mc(25,"Valor impuestos"),d.ac(),d.bc(26,"th"),d.Mc(27,"Valor final"),d.ac(),d.ac(),d.bc(28,"tbody"),d.Lc(29,G,28,28,"tr",7),d.nc(30,"paginate"),d.ac(),d.ac(),d.bc(31,"div",8),d.bc(32,"pagination-controls",9),d.ic("pageChange",(function(t){return e.p=t})),d.ac(),d.ac(),d.ac(),d.Lc(33,j,1,0,"app-img-loading",4)),2&t&&(d.Jb(2),d.Oc(" Precios por art\xedculo de mantenimiento del concesionario: ",null!=e.dealerSelected?e.dealerSelected.name:d.oc(3,5,"")," "),d.Jb(4),d.Oc("Tipo de descuento: ",e.getTypeDiscount(),""),d.Jb(3),d.uc("ngIf",e.isCheckboxVisible),d.Jb(20),d.uc("ngForOf",d.pc(30,7,e.lsMaintenanceItems,d.xc(10,q,e.p))),d.Jb(4),d.uc("ngIf",e.isAwaiting))},directives:[c.o,c.n,J.c,N.a],pipes:[c.x,J.b,c.w,c.d],styles:["input[_ngcontent-%COMP%]::-webkit-inner-spin-button, input[_ngcontent-%COMP%]::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}input[type=number][_ngcontent-%COMP%]{-moz-appearance:textfield}h2[_ngcontent-%COMP%]{margin-top:20px;margin-bottom:40px}"]}),t})();var H=i("KBxE");function Y(t,e){1&t&&(d.bc(0,"div",28),d.bc(1,"p"),d.Mc(2,"* El cliente es necesario para guardar el contrato"),d.ac(),d.ac())}function K(t,e){1&t&&(d.bc(0,"div",28),d.bc(1,"p"),d.Mc(2,"* El concesionario es necesario para guardar el contrato"),d.ac(),d.ac())}function X(t,e){1&t&&(d.bc(0,"p"),d.Mc(1," * La cantidad de veh\xedculos es requerida "),d.ac())}function Q(t,e){if(1&t&&(d.bc(0,"div",28),d.Lc(1,X,2,0,"p",26),d.ac()),2&t){const t=d.mc();d.Jb(1),d.uc("ngIf",t.amountVehiclesField.hasError("required"))}}function Z(t,e){1&t&&(d.bc(0,"p"),d.Mc(1," * La duraci\xf3n del contrato es requerida "),d.ac())}function tt(t,e){if(1&t&&(d.bc(0,"div",28),d.Lc(1,Z,2,0,"p",26),d.ac()),2&t){const t=d.mc();d.Jb(1),d.uc("ngIf",t.durationField.hasError("required"))}}function et(t,e){1&t&&(d.bc(0,"p"),d.Mc(1," * La fecha inicial del contrato es requerida "),d.ac())}function it(t,e){if(1&t&&(d.bc(0,"div",28),d.Lc(1,et,2,0,"p",26),d.ac()),2&t){const t=d.mc();d.Jb(1),d.uc("ngIf",t.startingDateField.hasError("required"))}}function ct(t,e){1&t&&(d.bc(0,"div",28),d.bc(1,"p"),d.Mc(2," * El tipo de descuento es requerido para guardar el contrato "),d.ac(),d.ac())}function nt(t,e){1&t&&(d.bc(0,"p"),d.Mc(1," * El valor del descuento que debe aplicarse al contrato es requerido "),d.ac())}function st(t,e){1&t&&(d.bc(0,"p"),d.Mc(1," * Si el tipo de descuento es por porcentaje, el valor de este campo no puede sobrepasar el valor de 100 "),d.ac())}function at(t,e){if(1&t&&(d.bc(0,"div",28),d.Lc(1,nt,2,0,"p",26),d.Lc(2,st,2,0,"p",26),d.ac()),2&t){const t=d.mc();d.Jb(1),d.uc("ngIf",t.discountValueField.hasError("required")),d.Jb(1),d.uc("ngIf",t.discountValueField.hasError("maxValueAllowed"))}}function ot(t,e){1&t&&d.Wb(0,"app-img-loading")}function rt(t,e){if(1&t){const t=d.cc();d.bc(0,"app-alert-error",29),d.ic("onAlertWasClose",(function(){return d.Dc(t),d.mc().closeError()})),d.ac()}if(2&t){const t=d.mc();d.uc("title",t.errorTitle)("errorMessage",t.errorDescription)}}const lt=function(){return{dateInputFormat:"YYYY/MM/DD",containerClass:"theme-dark-blue"}};let dt=(()=>{class t{constructor(t,e,i,c,n,s,a){this.clientService=t,this.dealerService=e,this.contractService=i,this.router=c,this.formBuilder=n,this.activatedRoute=s,this.contracStateService=a,this.contractWasSetted=new d.q,this.lsVehicleModelsTemp=[],this.modelsToFilter=[],this.clientToFilter=void 0,this.client=void 0,this.dealer=void 0,this.discountType=void 0,this.discountValue=0,this.vehicles=[],this.maintenanceItems=[],this.isErrorVisible=!1,this.errorTitle="",this.errorDescription="";const o=new Date;new Date(o.getFullYear(),o.getMonth()+1,o.getDay()),this.dtStartingDate=o,this.dtEndingDate=o,this.buildContractForm(),this.clientFieldIsInvalid=!1,this.dealerFieldIsInvalid=!1,this.contracStateFieldIsInvalid=!1,this.discountFieldIsInvalid=!1,this.lsMaintenanceItemsTemp=[],this.disableClientField=!1,this.disableTypeOfDiscoutnField=!1,this.disableVehicles=!1,this.buttonSaveIsDisable=!1,this.disableCmbState=!1,this.contracStateService.client$.subscribe(t=>{this.client=t,this.clientFieldIsInvalid=!this.client}),this.contracStateService.dealer$.subscribe(t=>{this.dealer=t,this.dealerFieldIsInvalid=!this.dealer}),this.contracStateService.contractState$.subscribe(t=>{this.contractState=t}),this.contracStateService.discountType$.subscribe(t=>{this.discountType=t,this.validateDiscountValues()}),this.contracStateService.discountValue$.subscribe(t=>{this.discountValue=t}),this.contracStateService.vehicleModel$.subscribe(t=>{this.modelsToFilter=t}),this.contracStateService.vehicles$.subscribe(t=>{this.vehicles=t}),this.contracStateService.maintenanceItems$.subscribe(t=>{this.maintenanceItems=t}),this.frmContract.controls.discountValue.valueChanges.subscribe(t=>{this.contracStateService.setDiscountValue(t),this.validateDiscountValues()})}buildContractForm(){this.frmContract=this.formBuilder.group({name:[""],duration:["",[n.z.required]],startingDate:["",[n.z.required]],endingDate:["",[n.z.required]],discountValue:["",[n.z.required]],observation:[""],amountVehicles:["",[n.z.required]]})}ngOnChanges(t){this.validateCompanyLogged()}ngOnInit(){this.extractParamsFromURL(),this.getInitContractState(),this.initComponents()}extractParamsFromURL(){try{this.activatedRoute.params.subscribe(t=>{console.log("parametros"),console.log(t),Object.keys(t).length>0?this.getContractByID(t.id):console.log("No debe buscar nada y debe resetear valores")})}catch(t){console.log(t)}}getContractByID(t){this.isAwaiting=!0,this.contractService.getContractByID(t).subscribe({next:t=>{this.contractService.setContract(t),this.contractToUpdate=t,console.log("getContractByID"),console.log(this.contractToUpdate),this.contractToUpdate&&(this.contracStateService.setClientToContract(this.contractToUpdate.client),this.contracStateService.setDealerToContract(this.contractToUpdate.dealer),this.contracStateService.setDiscountType(this.contractToUpdate.discountType),this.contracStateService.setDiscountValue(this.contractToUpdate.discountValue),this.contractToUpdate.lsVehicleModels.forEach(t=>{this.contracStateService.addVehicleModelToList(t)}),this.contractToUpdate.lsVehicles.forEach(t=>this.contracStateService.addVehicleToList(t)),this.validateContractToUpdate()),this.isAwaiting=!1},error:t=>{this.isAwaiting=!1,this.isErrorVisible=!0,this.errorTitle="Ocurri\xf3 un error intentando consultar el contrato",this.errorDescription=""+t.error.Message}})}get contractNameField(){return this.frmContract.get("name")}get durationField(){return this.frmContract.get("duration")}get startingDateField(){return this.frmContract.get("startingDate")}get endingDateField(){return this.frmContract.get("endingDate")}get discountValueField(){return this.frmContract.get("discountValue")}get observationField(){return this.frmContract.get("observation")}get amountVehiclesField(){return this.frmContract.get("amountVehicles")}initComponents(){const t=Object(C.a)("actionToPerform");this.action=parseInt(t),this.validateCompanyLogged(),this.oChangeDealer=0,this.isAwaiting=!1,this.contract=new b.a,this.enableOrDisableForm()}async getInitContractState(){this.contractService.getContractinitState().subscribe(t=>{this.contractState=t,console.log(this.contractState)})}async validateCompanyLogged(){try{switch(this.company=m.a.validateUserAndCompany(),this.company.type){case u.a.DEALER:this.disableDealerField=!0,this.dealerService.getDealerById(this.company.id).subscribe(t=>{this.dealerService.setDealerSelected(t)});break;case u.a.CLIENT:break;default:this.disableDealerField=!1}}catch(t){console.warn(t)}}validateContractToUpdate(){null!=this.contractToUpdate&&null!=this.contractToUpdate?(this.isToUpdate=!0,this.setDataInForm(this.contractToUpdate)):this.resetContractData()}setClientSelected(){this.contract.client=this.clientService.getClientSelected(),this.clientToFilter=this.contract.client,this.contracStateService.setClientToContract(this.clientToFilter),this.clientFieldIsInvalid=null==this.contract.client||null==this.contract.client}setDealerSelected(){this.contract.dealer=this.dealerService.getDealerSelected(),this.contracStateService.setDealerToContract(this.contract.dealer),this.dealerFieldIsInvalid=null==this.contract.dealer||null==this.contract.dealer}calculateEndingDate(){const{duration:t,startingDate:e}=this.frmContract.controls;let i=e.value,c=null;try{c=this.formatDate(i.toISOString().substring(0,10))}catch(a){i=""+e.value,c=this.formatDate(i.substr(0,10))}const n=t.value,s=new Date(c.getFullYear(),c.getMonth()-1,c.getDate());s.setMonth(s.getMonth()+n),s.toISOString().substring(0,10),this.dtEndingDate=s}setDataInForm(t){this.frmContract.patchValue(t),this.dtStartingDate=this.formatDate(t.startingDate.toString().substr(0,10)),this.dtEndingDate=this.formatDate(t.endingDate.toString().substr(0,10))}saveContract(){const{name:t,startingDate:e,endingDate:i,amountVehicles:c,duration:n,observation:s}=this.frmContract.controls;try{if(this.frmContract.valid&&(this.contract=new b.a,this.contract.name=t.value,this.contract.startingDate=e.value,this.contract.endingDate=i.value,this.contract.amountVehicles=c.value,this.contract.duration=n.value,this.contract.observation=s.value,confirm("\xbfEst\xe1 seguro que desea guardar los datos asociados a este contrato?"))){if(null!=this.contractToUpdate&&null!=this.contractToUpdate&&(this.contract.id=this.contractToUpdate.id,this.contract.code=this.contractToUpdate.code,this.contract.consecutive=this.contractToUpdate.consecutive),this.contract.client=this.client,null==this.contract.client||null==this.contract.client)throw this.clientFieldIsInvalid=!0,new Error("Se debe seleccionar un cliente");if(this.contract.dealer=this.dealer,null==this.contract.dealer||null==this.contract.dealer)throw this.dealerFieldIsInvalid=!0,new Error("Se debe seleccionar un concesionario");if(this.contract.contractState=this.contractState,this.contract.discountType=this.discountType,this.contract.discountValue=this.discountValue,this.contract.lsVehicleModels=this.modelsToFilter,this.contract.lsVehicles=this.vehicles,this.contract.lsVehicles.length>this.contract.amountVehicles)throw new Error(`Verifique que la cantidad de veh\xedculos seleccionados no exceda la cantidad de vehiculos contratados.\n                Cantidad de veh\xedculos permitida: ${this.contract.amountVehicles} Cantidad de veh\xedculos seleccionados: ${this.contract.lsVehicles.length}`);this.contract.lsMaintenanceItems=this.maintenanceItems,console.log(this.maintenanceItems),this.saveData(this.contract)}}catch(a){this.isErrorVisible=!0,this.errorTitle="Se ha encontrado una inconsistencia dentro de la informaci\xf3n del contrato.",this.errorDescription=""+a,this.isAwaiting=!1}}saveData(t){console.warn("[saveData - Contract]",t),this.isAwaiting=!0,this.isToUpdate?this.contractService.update(t).subscribe({next:t=>{M.a.fire({position:"center",icon:"success",title:t.message,showConfirmButton:!0}),this.isAwaiting=!1,this.contracStateService.resetContractInformation(),this.router.navigate(["/MasterContracts"])},error:t=>{this.isAwaiting=!1,this.isErrorVisible=!0,this.errorTitle="Error actualizando contrato",this.errorDescription="Se ha producido un error intentando actualizar el contrato. "+t.error.Message}}):this.contractService.insert(t).subscribe({next:t=>{M.a.fire({position:"center",icon:"success",title:t.message,showConfirmButton:!0}),this.isAwaiting=!1,this.contracStateService.resetContractInformation(),this.router.navigate(["/MasterContracts"])},error:t=>{this.isAwaiting=!1,this.isErrorVisible=!0,this.errorTitle="Error creando contrato",this.errorDescription="Se ha producido un error intentando guardar el contrato en la base de datos.  "+t.error.Message}})}comeBackTable(){this.resetContractData(),this.router.navigate(["/MasterContracts"])}formatDate(t){const e=parseInt(t.substring(0,4)),i=parseInt(t.substring(5,7)),c=parseInt(t.substring(8,10));return new Date(e,i,c)}validateNumbers(t){return f.a.validateTyping(t,"numbers")}validateInputDate(t){return t.preventDefault(),null}setDiscountType(t){null==t||null==t?this.discountFieldIsInvalid=!0:(this.discountType=t,this.discountFieldIsInvalid=!1),this.contracStateService.setDiscountType(this.discountType)}setItemsByContract(t){try{this.contract.lsMaintenanceItems=null!=t&&null!=t?t:[]}catch(e){console.warn(e)}}disableContract(t){const{name:e,duration:i,startingDate:c,discountValue:n,observation:s,amountVehicles:a}=this.frmContract.controls;t.id!=p.a.EN_NEGOCIACION?(e.disable(),i.disable(),c.disable(),n.disable(),s.disable(),a.disable(),this.disableClientField=!0,this.disableDealerField=!0,this.disableTypeOfDiscoutnField=!0,this.disableVehicleTypesAndVehicleModels=!0,this.disableVehicles=!0):(e.enable(),i.enable(),c.enable(),n.enable(),s.enable(),a.enable(),this.disableClientField=!1,this.disableDealerField=!1,this.disableTypeOfDiscoutnField=!1,this.disableVehicleTypesAndVehicleModels=!1,this.disableVehicles=!1)}enableOrDisableForm(){try{const t=this.contractService.getContractIsToEdit();switch(this.action){case h.a.CREATE:this.disableClientField=!1,this.disableDealerField=!1,this.disableTypeOfDiscoutnField=!1,this.frmContract.enable(),this.buttonSaveIsDisable=!1,this.disableCmbState=!1,this.disableVehicleTypesAndVehicleModels=!1,this.disableVehicles=!1;break;case h.a.READ:this.disableClientField=!0,this.disableDealerField=!0,this.disableTypeOfDiscoutnField=!0,this.frmContract.disable(),this.buttonSaveIsDisable=!0,this.disableCmbState=!0,this.disableVehicleTypesAndVehicleModels=!0,this.disableVehicles=!0;break;case h.a.UPDATE:(t||this.action==h.a.UPDATE)&&(this.disableCmbState=!1)}}catch(t){console.warn("[Enable or diable form]",t)}}resetContractData(){this.isToUpdate=!1,this.contracStateService.resetContractInformation()}closeError(){this.isErrorVisible=!1}validateDiscountValues(){this.discountType&&this.frmContract.controls.discountValue.setErrors((this.discountType.id==g.b.PORCENTAJE_POR_REPUESTOS||this.discountType.id==g.b.PORCENTAJE_POR__TOTAL_MANTENIMIENTO)&&this.discountValue>100?{maxValueAllowed:!0}:null)}}return t.\u0275fac=function(e){return new(e||t)(d.Vb(S.a),d.Vb(y.a),d.Vb(I.a),d.Vb(r.b),d.Vb(n.f),d.Vb(r.a),d.Vb(T.a))},t.\u0275cmp=d.Pb({type:t,selectors:[["app-contract"]],inputs:{countChanges:"countChanges",contractIsToUpdate:"contractIsToUpdate"},outputs:{contractWasSetted:"contractWasSetted"},features:[d.Hb],decls:64,vars:26,consts:[["id","container__content"],["mat-align-tabs","start"],["label","Datos del contrato"],[1,"form-basic-data",3,"formGroup"],[1,"container__row"],[1,"container__col"],[3,"client","disableField","clientWasSetted"],["class","error",4,"ngIf"],[3,"dealer","disableField","dealerWasSetted"],["type","text","formControlName","name","placeholder","C\xf3digo de referencia del contrato ...",1,"form-control"],["type","text","formControlName","amountVehicles","placeholder","cantidad de veh\xedculos contratados",1,"form-control",3,"keypress"],["type","number","formControlName","duration","placeholder","Duraci\xf3n del contrato ...",1,"form-control",3,"keypress","input"],["type","text","formControlName","startingDate","placeholder","fecha de inicio ...","bsDatepicker","",1,"form-control",3,"bsValue","bsConfig","keypress","onHidden"],["type","text","formControlName","endingDate","placeholder","fecha de finalizaci\xf3n ...","bsDatepicker","","disabled","",1,"form-control",3,"bsValue","bsConfig"],[3,"disableField","discountWasSelected"],["type","number","formControlName","discountValue","placeholder","valor del descuento ...",1,"form-control",3,"keypress"],[1,"container__observation"],["formControlName","observation","cols","30","rows","2",1,"form-control"],["label","L\xedneas contratadas"],[3,"disableChecks"],["label","Veh\xedculos contratados"],[3,"amountAllowed","disableChecks","contractToFilter"],["label","Precios contratados"],[1,"buttons__container"],["type","button",1,"btn","btn-danger",3,"click"],["type","button",1,"btn","btn-success",3,"disabled","click"],[4,"ngIf"],[3,"title","errorMessage","onAlertWasClose",4,"ngIf"],[1,"error"],[3,"title","errorMessage","onAlertWasClose"]],template:function(t,e){1&t&&(d.bc(0,"div",0),d.bc(1,"mat-tab-group",1),d.bc(2,"mat-tab",2),d.bc(3,"form",3),d.bc(4,"div",4),d.bc(5,"div",5),d.bc(6,"app-input-search-client",6),d.ic("clientWasSetted",(function(){return e.setClientSelected()})),d.ac(),d.Lc(7,Y,3,0,"div",7),d.ac(),d.bc(8,"div",5),d.bc(9,"app-input-search-dealer",8),d.ic("dealerWasSetted",(function(){return e.setDealerSelected()})),d.ac(),d.Lc(10,K,3,0,"div",7),d.ac(),d.ac(),d.bc(11,"div",4),d.bc(12,"div",5),d.bc(13,"label"),d.Mc(14,"C\xf3digo de referencia del contrato"),d.ac(),d.Wb(15,"input",9),d.ac(),d.ac(),d.bc(16,"div",4),d.bc(17,"div",5),d.bc(18,"label"),d.Mc(19,"Cantidad de veh\xedculos contratados"),d.ac(),d.bc(20,"input",10),d.ic("keypress",(function(t){return e.validateNumbers(t)})),d.ac(),d.Lc(21,Q,2,1,"div",7),d.ac(),d.bc(22,"div",5),d.bc(23,"label"),d.Mc(24,"Duraci\xf3n en meses:"),d.ac(),d.bc(25,"input",11),d.ic("keypress",(function(t){return e.validateNumbers(t)}))("input",(function(){return e.calculateEndingDate()})),d.ac(),d.Lc(26,tt,2,1,"div",7),d.ac(),d.ac(),d.bc(27,"div",4),d.bc(28,"div",5),d.bc(29,"label"),d.Mc(30,"Fecha de inicio:"),d.ac(),d.bc(31,"input",12),d.ic("keypress",(function(t){return e.validateInputDate(t)}))("onHidden",(function(){return e.calculateEndingDate()})),d.ac(),d.Lc(32,it,2,1,"div",7),d.ac(),d.bc(33,"div",5),d.bc(34,"label"),d.Mc(35,"Fecha de finalizaci\xf3n:"),d.ac(),d.Wb(36,"input",13),d.ac(),d.ac(),d.bc(37,"div",4),d.bc(38,"div",5),d.bc(39,"app-contract-discount-type",14),d.ic("discountWasSelected",(function(t){return e.setDiscountType(t)})),d.ac(),d.Lc(40,ct,3,0,"div",7),d.ac(),d.bc(41,"div",5),d.bc(42,"label"),d.Mc(43,"Valor del descuento:"),d.ac(),d.bc(44,"input",15),d.ic("keypress",(function(t){return e.validateNumbers(t)})),d.ac(),d.Lc(45,at,3,2,"div",7),d.ac(),d.ac(),d.bc(46,"div",16),d.bc(47,"label"),d.Mc(48,"Observaciones: "),d.ac(),d.bc(49,"textarea",17),d.Mc(50,"          "),d.ac(),d.ac(),d.ac(),d.ac(),d.bc(51,"mat-tab",18),d.Wb(52,"app-check-list-vehicle-model",19),d.ac(),d.bc(53,"mat-tab",20),d.Wb(54,"app-tbl-check-vehicles",21),d.ac(),d.bc(55,"mat-tab",22),d.Wb(56,"app-tbl-prices-by-contract"),d.ac(),d.ac(),d.bc(57,"div",23),d.bc(58,"button",24),d.ic("click",(function(){return e.comeBackTable()})),d.Mc(59," Cancelar "),d.ac(),d.bc(60,"button",25),d.ic("click",(function(){return e.saveContract()})),d.Mc(61," Guardar "),d.ac(),d.ac(),d.ac(),d.Lc(62,ot,1,0,"app-img-loading",26),d.Lc(63,rt,1,2,"app-alert-error",27)),2&t&&(d.Jb(3),d.uc("formGroup",e.frmContract),d.Jb(3),d.uc("client",e.client)("disableField",e.disableClientField),d.Jb(1),d.uc("ngIf",e.clientFieldIsInvalid),d.Jb(2),d.uc("dealer",e.dealer)("disableField",e.disableDealerField),d.Jb(1),d.uc("ngIf",e.dealerFieldIsInvalid),d.Jb(11),d.uc("ngIf",e.amountVehiclesField.invalid&&(e.amountVehiclesField.touched||e.amountVehiclesField.dirty)),d.Jb(5),d.uc("ngIf",e.durationField.invalid&&(e.durationField.touched||e.durationField.dirty)),d.Jb(5),d.uc("bsValue",e.dtStartingDate)("bsConfig",d.wc(24,lt)),d.Jb(1),d.uc("ngIf",e.startingDateField.invalid&&(e.startingDateField.touched||e.startingDateField.dirty)),d.Jb(4),d.uc("bsValue",e.dtEndingDate)("bsConfig",d.wc(25,lt)),d.Jb(3),d.uc("disableField",e.disableTypeOfDiscoutnField),d.Jb(1),d.uc("ngIf",e.discountFieldIsInvalid),d.Jb(5),d.uc("ngIf",e.discountValueField.invalid&&(e.discountValueField.touched||e.discountValueField.dirty)),d.Jb(7),d.uc("disableChecks",e.disableVehicleTypesAndVehicleModels),d.Jb(2),d.uc("amountAllowed",e.amountVehiclesField.value)("disableChecks",e.disableVehicles)("contractToFilter",e.contractToUpdate),d.Jb(6),d.uc("disabled",e.frmContract.invalid||e.clientFieldIsInvalid||e.dealerFieldIsInvalid||e.contracStateFieldIsInvalid||e.discountFieldIsInvalid||e.buttonSaveIsDisable),d.Jb(2),d.uc("ngIf",e.isAwaiting),d.Jb(1),d.uc("ngIf",e.isErrorVisible))},directives:[s.b,s.a,n.B,n.r,n.k,_.a,c.o,D.a,n.c,n.q,n.i,n.v,a.b,a.a,V,x.a,L,z,N.a,H.a],styles:['.container__row[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;grid-row:1fr}.container__col[_ngcontent-%COMP%], .container__observation[_ngcontent-%COMP%], .container__vehicleModel[_ngcontent-%COMP%]{padding:10px}.buttons__container[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}.buttons__container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:200px;margin-left:10px;margin-top:20px}.card-body[_ngcontent-%COMP%]{padding:10px}.container__titles[_ngcontent-%COMP%]{overflow:hidden;border:1px solid #ccc;background-color:#f1f1f1}.container__titles[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:inherit;float:left;border:none;outline:none;cursor:pointer;padding:14px 16px;transition:.3s;font-size:20px}.container__titles[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#ddd}.container__titles[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%]{background-color:#ccc}.tab_content[_ngcontent-%COMP%]{padding:20px 50px;border:1px solid #ccc;border-top:none}#container__content[_ngcontent-%COMP%]{transition:margin-left 1s;padding:20px;margin-left:250px}.error[_ngcontent-%COMP%]{color:red;margin-top:10px}.container__infoError[_ngcontent-%COMP%]:before{position:absolute;content:"";display:block;width:0;height:0;left:50%;margin-left:-10px;margin-top:-30px;border:10px solid transparent;border-bottom-color:#ebd4d4}.form-basic-data[_ngcontent-%COMP%]{margin-top:20px}.container__infoError[_ngcontent-%COMP%]{background-color:#ebd4d4;cursor:pointer;position:absolute;padding:10px 15px;z-index:50;width:200px;height:auto;border-radius:20px;right:3%;margin-top:30px;box-shadow:10px 10px 17px -7px rgba(0,0,0,.75)}']}),t})();var ht=i("QgiH"),ut=i("eeG/");function bt(t,e){if(1&t){const t=d.cc();d.bc(0,"button",13),d.ic("click",(function(){return d.Dc(t),d.mc().insertContract()})),d.Wb(1,"i",14),d.ac()}}function pt(t,e){if(1&t){const t=d.cc();d.bc(0,"i",19),d.ic("click",(function(){d.Dc(t);const e=d.mc().$implicit;return d.mc().updateContract(e)})),d.ac()}}function gt(t,e){if(1&t){const t=d.cc();d.bc(0,"i",20),d.ic("click",(function(){d.Dc(t);const e=d.mc().$implicit;return d.mc().deleteContract(e)})),d.ac()}}function mt(t,e){if(1&t){const t=d.cc();d.bc(0,"tr"),d.bc(1,"td"),d.Mc(2),d.ac(),d.bc(3,"td"),d.Mc(4),d.ac(),d.bc(5,"td"),d.Mc(6),d.nc(7,"uppercase"),d.ac(),d.bc(8,"td"),d.Mc(9),d.nc(10,"titlecase"),d.ac(),d.bc(11,"td"),d.Mc(12),d.nc(13,"titlecase"),d.ac(),d.bc(14,"td"),d.Mc(15),d.ac(),d.bc(16,"td"),d.Mc(17),d.ac(),d.bc(18,"td"),d.bc(19,"span",15),d.Mc(20),d.nc(21,"titlecase"),d.ac(),d.ac(),d.bc(22,"td"),d.bc(23,"i",16),d.ic("click",(function(){d.Dc(t);const i=e.$implicit;return d.mc().getDetailsContract(i)})),d.ac(),d.Lc(24,pt,1,0,"i",17),d.Lc(25,gt,1,0,"i",18),d.ac(),d.ac()}if(2&t){const t=e.index,i=e.$implicit,c=d.mc();d.Jb(2),d.Nc(t+1),d.Jb(2),d.Nc(i.code),d.Jb(2),d.Nc(d.oc(7,11,i.name)),d.Jb(3),d.Nc(d.oc(10,13,i.client.name)),d.Jb(3),d.Nc(d.oc(13,15,i.dealer.name)),d.Jb(3),d.Nc(i.duration),d.Jb(2),d.Nc(i.amountVehicles),d.Jb(2),d.uc("ngClass",c.getClass(i.contractState.name)),d.Jb(1),d.Oc(" ",d.oc(21,17,i.contractState.name)," "),d.Jb(4),d.uc("ngIf",c.enableButtonsEditAndDelete),d.Jb(1),d.uc("ngIf",c.enableButtonsEditAndDelete)}}function ft(t,e){1&t&&d.Wb(0,"app-img-loading")}const Ct=function(t){return{itemsPerPage:10,currentPage:t}},vt=[{path:"",component:l.a,children:[{path:"",component:(()=>{class t{constructor(t,e,i){this.contractService=t,this.router=e,this.contracStateService=i,this.p=1,this.lsContracts=[],this.lsContractsFiltered=[],this.txtFilter=new n.g,this.hideButtonAdd=!1,this.txtFilter.valueChanges.subscribe(t=>{this.filterContracts(t)})}ngOnInit(){this.enableButtonsEditAndDelete=!0,this.initComponents()}validateCompany(){try{this.companyStorage=m.a.validateUserAndCompany()}catch(t){console.warn(t)}}async initComponents(){this.validateCompany(),this.isToUpdate=!1,this.isAwaiting=!1,this.getListContracts()}getClass(t){return Object(ut.a)(t)}getListContracts(){switch(this.isAwaiting=!0,this.companyStorage.type){case u.a.DEALER:this.contractService.getContracts(this.companyStorage.id).subscribe(t=>{this.lsContracts=t,this.lsContractsFiltered=this.lsContracts,this.isAwaiting=!1}),this.hideButtonAdd=!0,this.enableButtonsEditAndDelete=!1;break;case u.a.CLIENT:this.contractService.getContracts(0,this.companyStorage.id).subscribe(t=>{this.lsContracts=t,this.lsContractsFiltered=this.lsContracts,this.isAwaiting=!1}),this.hideButtonAdd=!0,this.enableButtonsEditAndDelete=!1;break;default:this.contractService.getContracts().subscribe(t=>{this.lsContracts=t,this.lsContractsFiltered=this.lsContracts,this.isAwaiting=!1}),this.hideButtonAdd=!1,this.enableButtonsEditAndDelete=!0}}moveContent(t){document.querySelector("#container__content").style.marginLeft=t?"250px":"0px"}insertContract(){this.resetContractState(),this.isToUpdate=!1,this.contractService.setContract(null),Object(C.b)("actionToPerform",h.a.CREATE),this.router.navigate(["/MasterContracts/Contract"])}getDetailsContract(t){this.resetContractState(),Object(C.b)("actionToPerform",h.a.READ),this.router.navigate(["/MasterContracts/Contract/"+t.id])}updateContract(t){this.resetContractState(),Object(C.b)("actionToPerform",h.a.UPDATE),this.router.navigate(["/MasterContracts/Contract/"+t.id])}deleteContract(t){confirm("\xbfEst\xe1 seguro que desea elminar este contrato?, al hacerlo se eliminar\xe1 toda la informaci\xf3n relacionada")&&(this.isAwaiting=!0,this.contractService.delete(t).subscribe(t=>{t.response&&(M.a.fire({position:"center",icon:"success",title:t.message,showConfirmButton:!0}),this.getListContracts()),this.isAwaiting=!1}))}resetContractState(){this.contracStateService.resetContractInformation()}filterContracts(t){try{this.lsContractsFiltered=this.lsContracts.filter(e=>e.code.toLocaleLowerCase().includes(t.toLocaleLowerCase())||e.name.toLocaleLowerCase().includes(t.toLocaleLowerCase())||e.consecutive==parseInt(t)||e.client.name.toLocaleLowerCase().includes(t.toLocaleLowerCase())||e.dealer.name.toLocaleLowerCase().includes(t.toLocaleLowerCase()))}catch(e){console.log(e)}}removeFilter(){this.txtFilter.setValue(null),this.lsContractsFiltered=this.lsContracts}downloadExcel(){const t=this.lsContractsFiltered.map(t=>{var e,i;return{CodigoInterno:t.code,CodigoReferencia:t.name,Cliente:null===(e=t.client)||void 0===e?void 0:e.name,Concesionario:null===(i=t.dealer)||void 0===i?void 0:i.name,PlazoEnMeses:t.duration,VehiculosContratados:t.amountVehicles,Estado:t.contractState.name}});ht.a.convertArrayToFile(t,"Contratos")}}return t.\u0275fac=function(e){return new(e||t)(d.Vb(I.a),d.Vb(r.b),d.Vb(T.a))},t.\u0275cmp=d.Pb({type:t,selectors:[["app-tbl-contract"]],decls:37,vars:9,consts:[["id","container__content"],[1,"container-filter"],["type","text","placeholder","C\xf3digo , Cliente \xf3 Concesionario",1,"form-control",3,"formControl"],["type","button",1,"btn","btn-danger",3,"click"],[1,"text-right"],[1,"btn","btn-primary",3,"click"],["class","btn-add btn-info",3,"click",4,"ngIf"],[1,"table","table-striped"],["title","Veh\xedculos contratados"],[4,"ngFor","ngForOf"],[1,"paginationContainer"],[3,"pageChange"],[4,"ngIf"],[1,"btn-add","btn-info",3,"click"],[1,"fas","fa-plus"],[3,"ngClass"],["title","M\xe1s informaci\xf3n",1,"fas","fa-info-circle","text-info",3,"click"],["class","fas fa-edit text-warning","title","Modificar",3,"click",4,"ngIf"],["class","fas fa-trash-alt text-danger","title","Eliminar",3,"click",4,"ngIf"],["title","Modificar",1,"fas","fa-edit","text-warning",3,"click"],["title","Eliminar",1,"fas","fa-trash-alt","text-danger",3,"click"]],template:function(t,e){1&t&&(d.bc(0,"div",0),d.bc(1,"h1"),d.Mc(2,"Contratos"),d.ac(),d.bc(3,"div",1),d.Wb(4,"input",2),d.bc(5,"button",3),d.ic("click",(function(){return e.removeFilter()})),d.Mc(6," Borrar filtro "),d.ac(),d.bc(7,"div",4),d.bc(8,"button",5),d.ic("click",(function(){return e.downloadExcel()})),d.Mc(9," Descargar Excel "),d.ac(),d.ac(),d.ac(),d.Lc(10,bt,2,0,"button",6),d.bc(11,"table",7),d.bc(12,"thead"),d.bc(13,"th"),d.Mc(14,"#"),d.ac(),d.bc(15,"th"),d.Mc(16,"C\xf3digo interno"),d.ac(),d.bc(17,"th"),d.Mc(18,"C\xf3digo referencia"),d.ac(),d.bc(19,"th"),d.Mc(20,"Cliente"),d.ac(),d.bc(21,"th"),d.Mc(22,"Concesionario"),d.ac(),d.bc(23,"th"),d.Mc(24,"Plazo en meses"),d.ac(),d.bc(25,"th",8),d.Mc(26,"Veh. contratados"),d.ac(),d.bc(27,"th"),d.Mc(28,"Estado"),d.ac(),d.bc(29,"th"),d.Mc(30,"Acciones"),d.ac(),d.ac(),d.bc(31,"tbody"),d.Lc(32,mt,26,19,"tr",9),d.nc(33,"paginate"),d.ac(),d.ac(),d.bc(34,"div",10),d.bc(35,"pagination-controls",11),d.ic("pageChange",(function(t){return e.p=t})),d.ac(),d.ac(),d.ac(),d.Lc(36,ft,1,0,"app-img-loading",12)),2&t&&(d.Jb(4),d.uc("formControl",e.txtFilter),d.Jb(6),d.uc("ngIf",!e.hideButtonAdd),d.Jb(22),d.uc("ngForOf",d.pc(33,4,e.lsContractsFiltered,d.xc(7,Ct,e.p))),d.Jb(4),d.uc("ngIf",e.isAwaiting))},directives:[n.c,n.q,n.h,c.o,c.n,J.c,c.m,N.a],pipes:[J.b,c.y,c.x],styles:["i[_ngcontent-%COMP%]{margin:0 3px;cursor:pointer}.col-number[_ngcontent-%COMP%]{max-width:50px;width:50px}.btn-add[_ngcontent-%COMP%], table[_ngcontent-%COMP%]{cursor:pointer}.btn-add[_ngcontent-%COMP%]{border-radius:50%;width:50px;height:50px;position:relative;left:93%;margin-bottom:20px;top:30px;outline:none;text-align:center;font-size:24px;border:none;z-index:55}#container__content[_ngcontent-%COMP%]{transition:margin-left 1s;padding:20px 50px;margin-left:250px}@media only screen and (max-width:600px){.col-mobile-hide[_ngcontent-%COMP%]{display:none}.btn-add[_ngcontent-%COMP%]{left:80vw}}.container-filter[_ngcontent-%COMP%]{display:flex;flex-direction:row;margin-bottom:30px}.container-filter[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:150px;cursor:pointer;margin-left:10px}.tag-pending[_ngcontent-%COMP%]{background-color:#ff4f03;padding:8px 20px;width:150px}.tag-ending[_ngcontent-%COMP%], .tag-pending[_ngcontent-%COMP%]{display:flex;flex-direction:row;color:#fff;border-radius:20px;align-items:center;justify-content:center}.tag-ending[_ngcontent-%COMP%]{background-color:#469627;padding:8px 40px;width:180px}.tag-canceled[_ngcontent-%COMP%]{background-color:#7e0c2c}.tag-canceled[_ngcontent-%COMP%], .tag-waiting[_ngcontent-%COMP%]{display:flex;flex-direction:row;padding:8px 40px;color:#fff;border-radius:20px;width:180px;align-items:center;justify-content:center}.tag-waiting[_ngcontent-%COMP%]{background-color:#0f4a7e}"]}),t})()},{path:"Contract",component:dt},{path:"Contract/:id",component:dt}]}];let Mt=(()=>{class t{}return t.\u0275mod=d.Tb({type:t}),t.\u0275inj=d.Sb({factory:function(e){return new(e||t)},imports:[[r.f.forChild(vt)],r.f]}),t})(),St=(()=>{class t{}return t.\u0275mod=d.Tb({type:t}),t.\u0275inj=d.Sb({factory:function(e){return new(e||t)},imports:[[c.c,o.a,n.l,n.w,Mt,a.c.forRoot(),s.c]]}),t})()},R7St:function(t,e,i){"use strict";i.d(e,"a",(function(){return c}));class c{formatNumberToString(t){const e=Math.round(t).toString();let i="",c="";const n=e.indexOf(".");n>0?(i=e.substr(0,n),c=e.substr(n,e.length)):i=e.substr(0,e.length);const s=i.split("").reverse(),a=Math.floor(s.length/3);for(let r=0;r<a;r++){let t=0;const e=s.lastIndexOf(",");t=e>0?e+4:3,s.splice(t,0,",")}let o=s.reverse().join("");return","==o.split("")[0]&&(o=o.substr(1,o.length)),""!=c&&(c=c.replace(/\,/g,"."),o+=c),o}}},i5Qh:function(t,e,i){"use strict";i.d(e,"a",(function(){return r}));var c=i("tk/3"),n=i("LRne"),s=i("JIr8"),a=i("AytR"),o=i("fXoL");let r=(()=>{class t{constructor(t){this.http=t,this.URL_API=a.a.apiUrl+"/Client",this.HttpOptions={headers:new c.c({"Content-Type":"application/json"})}}getClients(){return this.http.get(this.URL_API+"/Get")}async getClientById(t){return this.http.get(`${this.URL_API}/GetById?pId=${t}`).toPromise()}async getClientByDocument(t){return this.http.get(`${this.URL_API}/GetByDocument?pDocument=${t}`).toPromise()}getClientsByDescriptions(t){return t.trim()?this.http.get(`${this.URL_API}/GetByDescription?sDescription=${t}`).pipe(Object(s.a)(this.handleError("getClientsByDescriptions",[]))):Object(n.a)([])}insertClient(t){return this.http.post(this.URL_API+"/Insert",t,this.HttpOptions)}updateClient(t){return this.http.post(this.URL_API+"/Update",t,this.HttpOptions)}async deleteClient(t){return this.http.post(this.URL_API+"/Delete",t,this.HttpOptions).toPromise()}setClientToUpdate(t){this.clientToUpdate=t}getClientToUpdate(){return this.clientToUpdate}setClientSelected(t){this.clientSelected=t}getClientSelected(){return this.clientSelected}getBlockFormClient(){return this.blockFormClient}setBlockFormClient(t){this.blockFormClient=t}getAction(){return this.action}setAction(t){this.action=t}handleError(t="operation",e){return t=>(console.error(t),Object(n.a)(e))}}return t.\u0275fac=function(e){return new(e||t)(o.fc(c.a))},t.\u0275prov=o.Rb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},"p9j/":function(t,e,i){"use strict";i.d(e,"a",(function(){return c}));class c{static validateTyping(t,e){if("numbers"==e)return!!/^\d+$/.test(t.key)||(t.preventDefault(),!1)}}},"xch/":function(t,e,i){"use strict";i.d(e,"a",(function(){return a}));var c=i("tk/3"),n=i("AytR"),s=i("fXoL");let a=(()=>{class t{constructor(t){this.http=t,this.URL_API=n.a.apiUrl+"/MaintenanceItem",this.HttpOptions={headers:new c.c({"Content-Type":"application/json"})}}getCategorySelected(){return this.category}setCategorySelected(t){this.category=t}getPresentationUnit(){return this.presentationUnit}setPresentationUnit(t){this.presentationUnit=t}getTypeOfItem(){return this.typeOfItem}getItem(){return this.item}setItem(t){this.item=t}settypeOfItem(t){this.typeOfItem=t}getItemToUpdate(){return this.itemToUpdate}setItemToUpdate(t){this.itemToUpdate=t}getMaintenanceItems(t){return this.http.get(`${this.URL_API}/Get?dealer_id=${t}`)}getMaintenanceItemById(t){return this.http.get(`${this.URL_API}/GetById?itemId=${t}`)}getItemsByVehicleModel(t){return this.http.get(`${this.URL_API}/GetItemsByVehicleModel?vehicleModel_id=${t}`)}getPresentationUnits(){return this.http.get(this.URL_API+"/GetPresentationUnits")}getCategories(){return this.http.get(this.URL_API+"/GetCategories")}getTypeOfMaintenanceItem(){return this.http.get(this.URL_API+"/getTypeOfMaintenanceItem")}getPricesByDealer(t){return this.http.get(`${this.URL_API}/GetPricesByDealer?dealer_id=${t}`)}setPricesByDealer(t){return this.http.post(this.URL_API+"/SetPricesByDealer",t,this.HttpOptions)}getPricesByContract(t){return this.http.get(`${this.URL_API}/GetPricesByContract?contract_id=${t}`)}setPricesByContract(t){return this.http.post(this.URL_API+"/SetPricesByContract",t,this.HttpOptions)}getTaxesList(){return this.http.get(this.URL_API+"/GetTaxesList")}insert(t){return this.http.post(this.URL_API+"/Insert",t,this.HttpOptions)}update(t){return this.http.put(this.URL_API+"/Update",t,this.HttpOptions)}delete(t){return this.http.delete(`${this.URL_API}/Delete?maintenanceItemId=${t.id}`,this.HttpOptions)}calculateTaxes(t,e){let i=0;if(e.length>0)for(const c of e)i+=Math.round(t*(c.percentValue/100));return i}calculateTotalByItem(t,e,i){return Math.round(t-e+i)}getItemRAAdministration(){return this.http.get(this.URL_API+"/GetByTypeId?typeId=3")}updateMaintence(t){return this.http.post(this.URL_API+"/Update",t)}}return t.\u0275fac=function(e){return new(e||t)(s.fc(c.a))},t.\u0275prov=s.Rb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()}}]);