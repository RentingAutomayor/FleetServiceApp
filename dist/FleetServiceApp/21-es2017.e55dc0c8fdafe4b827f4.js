(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{"5wyo":function(e,t,i){"use strict";i.r(t),i.d(t,"UserModule",(function(){return z}));var c=i("ofXK"),n=i("tyNb"),r=i("uswQ"),a=i("mrSG"),o=i("3Pt+"),s=i("aIEI"),l=i("wnuP"),b=i("fXoL"),d=i("AytR"),u=i("tk/3"),p=i("UbJi");let m=(()=>{class e{constructor(e,t){this.http=e,this._auth=t,this.URL_API=d.a.apiUrl+"/auth"}getAll(){return this.http.get(this.URL_API+"/GetAll")}getById(e){return this.http.get(`${this.URL_API}/GetById/${e}`)}save(e){return this.http.post(this.URL_API+"/Save",e)}update(e){return this.http.put(this.URL_API+"/Update",e)}deleteById(e){return this.http.delete(`${this.URL_API}/DeleteById/${e}`)}async create(e){return await this._auth.createUserWithEmailAndPassword(e.email,e.password)}async isExistsInFirebase(e){return await this._auth.fetchSignInMethodsForEmail(e)}}return e.\u0275fac=function(t){return new(t||e)(b.fc(u.a),b.fc(p.a))},e.\u0275prov=b.Rb({token:e,factory:e.\u0275fac}),e})();var g=i("iAZX"),h=i("ua6w"),f=i("3LUQ"),M=i("xHqg"),_=i("9Wwi");function y(e,t){1&e&&b.Mc(0,"Datos b\xe1sicos del usuario")}function v(e,t){if(1&e&&(b.bc(0,"option",29),b.Mc(1),b.ac()),2&e){const e=t.$implicit;b.uc("value",e.id),b.Jb(1),b.Oc(" ",e.name," ")}}function I(e,t){if(1&e&&(b.bc(0,"option",29),b.Mc(1),b.ac()),2&e){const e=t.$implicit;b.uc("value",e.id),b.Jb(1),b.Oc(" ",e.name," ")}}function C(e,t){if(1&e&&(b.bc(0,"option",29),b.Mc(1),b.ac()),2&e){const e=t.$implicit;b.uc("value",e.id),b.Jb(1),b.Oc(" ",e.name," ")}}function x(e,t){1&e&&b.Wb(0,"app-img-loading")}let O=(()=>{class e{constructor(e,t,i,c,n,r,a){this._user=e,this._role=t,this._parameter=i,this._alert=c,this.fb=n,this.router=r,this.route=a,this.isVisibility=!1,this.roles=[],this.companies=[],this.users=[],this.isLoading=!1,this.initForm()}ngOnInit(){this.getRoles(),this.getUserIdFromUrl(),this.getCompanies()}initForm(){this.userForm=this.fb.group({id:0,name:["",[o.z.required,o.z.pattern(l.a.letters)]],lastName:["",[o.z.required,o.z.pattern(l.a.letters)]],email:["",[o.z.required,o.z.pattern(l.a.email)]],password:["",[o.z.required,o.z.minLength(6)]],companyId:[{value:"",disabled:!0}],roleId:["",o.z.required],status:["",o.z.required],typeUser:[{value:"",disabled:!0}]})}getUserById(e){this.isLoading=!0,this._user.getById(e).subscribe(e=>{this.isLoading=!1;const{company:t,dealerId:i,clientId:c}=e,n=Object(a.h)(e,["company","dealerId","clientId"]),r=this.roles.find(e=>e.id===+n.roleId),o=Object.assign(Object.assign({},n),{companyId:r.name===w.RENTING?t.id:"",typeUser:r.name===w.DEALER?i:r.name===w.CLIENT?c:""});this.userForm.setValue(o),this.userForm.get("password").disable(),n.email&&this.userForm.get("email").disable()},e=>{let t=e.error.Message;t||(t=s.a),this._alert.error(t)})}getCompanies(){this._parameter.getCompanies().subscribe(e=>{this.companies=e},e=>{let t=e.error.Message;t||(t=s.a),this._alert.error(t)})}getClientOrDealer(e){this._parameter["client"===e?"getClient":"getDealer"]().subscribe(e=>{this.users=e},e=>{let t=e.error.Message;t||(t=s.a),this._alert.error(t)})}getRoles(){this._role.getAll().subscribe(e=>{this.roles=e},e=>{let t=e.error.Message;t||(t=s.a),this._alert.error(t)})}validRole(){const e=+this.userForm.get("roleId").value,t=this.roles.find(t=>t.id===e);t.name!==w.RENTING?(this.userForm.get("companyId").disable(),this.userForm.get("companyId").setValue("")):(this.enableField("companyId"),this.userForm.get("companyId").setValidators(o.z.required)),t.name===w.CLIENT||t.name===w.DEALER?this.enableField("typeUser"):(this.disableField("typeUser"),this.userForm.get("typeUser").setValue("")),t.name===w.CLIENT&&this.getClientOrDealer("client"),t.name===w.DEALER&&this.getClientOrDealer("dealer")}enableField(e){this.userForm.get(e).enable()}disableField(e){this.userForm.get(e).disable()}submit(){this.isLoading=!0;const e=0===this.userForm.get("id").value,t=this.userForm.getRawValue(),{companyId:i}=t,c=Object(a.h)(t,["companyId"]),n=this.buildUser(c,{id:i});this._user[e?"save":"update"](n).subscribe(()=>{this.createOnFirebase(c),this._alert.succes(`Usuario ${e?"creado":"actualizado"} con \xe9xito`),this.isLoading=!1,this.router.navigateByUrl("/MasterUsers")},e=>{let t=e.error.Message;t||(t=s.a),this._alert.error(t),this.isLoading=!1})}buildUser(e,t){const i=this.roles.find(t=>t.id===+e.roleId),c=i.name===w.RENTING,n=i.name===w.DEALER,r=i.name===w.CLIENT;return Object.assign(Object.assign({},e),{company:c?t:null,clientId:r?e.typeUser:null,dealerId:n?e.typeUser:null})}toggleVisibility(){this.isVisibility=!this.isVisibility}createOnFirebase(e){this._user.isExistsInFirebase(e.email).then(t=>{0==t.length&&this._user.create(e).catch(e=>this._alert.error(e.message))}).catch(e=>this._alert.error(e.message))}getUserIdFromUrl(){this.route.queryParams.subscribe(e=>{const t=e.userId;t&&this.getUserById(t)})}}return e.\u0275fac=function(t){return new(t||e)(b.Vb(m),b.Vb(g.a),b.Vb(h.a),b.Vb(f.a),b.Vb(o.f),b.Vb(n.b),b.Vb(n.a))},e.\u0275cmp=b.Pb({type:e,selectors:[["app-user-form"]],decls:75,vars:10,consts:[["id","container__content"],[3,"linear"],[3,"completed"],["matStepLabel",""],[1,"card","container","pt-3","pb-3"],[3,"formGroup","ngSubmit"],[1,"row"],[1,"col-6"],[1,"form-group"],["type","text","placeholder","Nombre","formControlName","name",1,"form-control"],["type","text","placeholder","Apellido","formControlName","lastName",1,"form-control"],["type","text","placeholder","Correo electronico","formControlName","email",1,"form-control"],[1,"input-group","mb-3"],["formControlName","password",1,"form-control",3,"type"],[1,"input-group-text","material-symbols-outlined","pointer",3,"click"],[1,"form-text"],["formControlName","roleId",1,"form-control",3,"change"],["value",""],[3,"value",4,"ngFor","ngForOf"],["formControlName","companyId",1,"form-control"],["formControlName","typeUser",1,"form-control"],["formControlName","status",1,"form-control"],["value","A"],["value","I"],[1,"cotainer-buttons"],["type","button","routerLink","/MasterUsers",1,"btn","btn-danger"],["type","submit",1,"btn","btn-success",3,"disabled"],[1,"col-12","text-center","text-required"],[4,"ngIf"],[3,"value"]],template:function(e,t){1&e&&(b.bc(0,"div",0),b.bc(1,"mat-vertical-stepper",1),b.bc(2,"mat-step",2),b.Lc(3,y,1,0,"ng-template",3),b.bc(4,"div",4),b.bc(5,"form",5),b.ic("ngSubmit",(function(){return t.submit()})),b.bc(6,"div",6),b.bc(7,"div",7),b.bc(8,"div",8),b.bc(9,"label"),b.Mc(10,"Nombre*:"),b.ac(),b.Wb(11,"input",9),b.ac(),b.ac(),b.bc(12,"div",7),b.bc(13,"div",8),b.bc(14,"label"),b.Mc(15,"Apellido*:"),b.ac(),b.Wb(16,"input",10),b.ac(),b.ac(),b.bc(17,"div",7),b.bc(18,"div",8),b.bc(19,"label"),b.Mc(20,"Correo electr\xf3nico*:"),b.ac(),b.Wb(21,"input",11),b.ac(),b.ac(),b.bc(22,"div",7),b.bc(23,"div",8),b.bc(24,"label"),b.Mc(25,"Contrase\xf1a*:"),b.ac(),b.bc(26,"div",12),b.Wb(27,"input",13),b.bc(28,"span",14),b.ic("click",(function(){return t.toggleVisibility()})),b.Mc(29),b.ac(),b.ac(),b.bc(30,"div",15),b.Mc(31," La contrase\xf1a debe ser mayor a 6 carecteres "),b.ac(),b.ac(),b.ac(),b.bc(32,"div",7),b.bc(33,"div",8),b.bc(34,"label"),b.Mc(35,"Rol*:"),b.ac(),b.bc(36,"select",16),b.ic("change",(function(){return t.validRole()})),b.bc(37,"option",17),b.Mc(38,"Seleccione..."),b.ac(),b.Lc(39,v,2,2,"option",18),b.ac(),b.ac(),b.ac(),b.bc(40,"div",7),b.bc(41,"div",8),b.bc(42,"label"),b.Mc(43,"Empresa*:"),b.ac(),b.bc(44,"select",19),b.bc(45,"option",17),b.Mc(46,"Seleccione..."),b.ac(),b.Lc(47,I,2,2,"option",18),b.ac(),b.ac(),b.ac(),b.bc(48,"div",7),b.bc(49,"div",8),b.bc(50,"label"),b.Mc(51,"Cliente / Concesionario"),b.ac(),b.bc(52,"select",20),b.bc(53,"option",17),b.Mc(54,"Seleccione..."),b.ac(),b.Lc(55,C,2,2,"option",18),b.ac(),b.ac(),b.ac(),b.bc(56,"div",7),b.bc(57,"div",8),b.bc(58,"label"),b.Mc(59,"Estado*:"),b.ac(),b.bc(60,"select",21),b.bc(61,"option",17),b.Mc(62,"Seleccione..."),b.ac(),b.bc(63,"option",22),b.Mc(64,"Activo"),b.ac(),b.bc(65,"option",23),b.Mc(66,"Inactivo"),b.ac(),b.ac(),b.ac(),b.ac(),b.ac(),b.bc(67,"div",24),b.bc(68,"button",25),b.Mc(69," Cancelar "),b.ac(),b.bc(70,"button",26),b.Mc(71," Guardar "),b.ac(),b.ac(),b.bc(72,"div",27),b.Mc(73," Campos obligatorios * "),b.ac(),b.ac(),b.ac(),b.ac(),b.ac(),b.ac(),b.Lc(74,x,1,0,"app-img-loading",28)),2&e&&(b.Jb(1),b.uc("linear",!0),b.Jb(1),b.uc("completed",!0),b.Jb(3),b.uc("formGroup",t.userForm),b.Jb(22),b.uc("type",t.isVisibility?"text":"password"),b.Jb(2),b.Oc(" ",t.isVisibility?"visibility_off":"visibility"," "),b.Jb(10),b.uc("ngForOf",t.roles),b.Jb(8),b.uc("ngForOf",t.companies),b.Jb(8),b.uc("ngForOf",t.users),b.Jb(15),b.uc("disabled",t.userForm.invalid),b.Jb(4),b.uc("ngIf",t.isLoading))},directives:[M.f,M.a,M.b,o.B,o.r,o.k,o.c,o.q,o.i,o.x,o.u,o.A,c.n,n.c,c.o,_.a],styles:[".card-body[_ngcontent-%COMP%]{padding:10px}.container__titles[_ngcontent-%COMP%]{overflow:hidden;border:1px solid #ccc;background-color:#f1f1f1}.container__titles[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:inherit;float:left;border:none;outline:none;cursor:pointer;padding:14px 16px;transition:.3s;font-size:20px}.container__titles[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#ddd}.container__titles[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%]{background-color:#ccc}.tab_content[_ngcontent-%COMP%]{padding:20px 50px;border:1px solid #ccc;border-top:none}#container__content[_ngcontent-%COMP%]{transition:margin-left 1s;padding:20px;margin-left:250px}#container__contact[_ngcontent-%COMP%]{padding:0;margin:0}.container__table__contact[_ngcontent-%COMP%]{padding:50px}.btn-step[_ngcontent-%COMP%]{width:100px;margin-left:5px}.container-step-buttons[_ngcontent-%COMP%]{direction:ltr;display:flex;justify-content:flex-end}.cotainer-buttons[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.pointer[_ngcontent-%COMP%]{cursor:pointer}.form-text[_ngcontent-%COMP%]{color:#6c757d}"]}),e})();var w=function(e){return e.ADMIN="TEC-SOP",e.CLIENT="USU-CLIENT",e.DEALER="USU-DEALER",e.RENTING="USU-RENTING",e}({}),U=i("0IaG"),P=i("QgiH");let L=(()=>{class e{constructor(e,t){this.user=e,this.dialogRef=t}closeDialog(){this.dialogRef.close()}}return e.\u0275fac=function(t){return new(t||e)(b.Vb(U.a),b.Vb(U.h))},e.\u0275cmp=b.Pb({type:e,selectors:[["app-user-view"]],decls:28,vars:4,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[1,"row"],[1,"col-6","mt-2"],[1,"form-control"],["mat-dialog-actions","",1,"mt-3"],[1,"btn","btn-danger",3,"click"]],template:function(e,t){1&e&&(b.bc(0,"div"),b.bc(1,"h2",0),b.Mc(2,"Detalle de usuario"),b.ac(),b.bc(3,"div",1),b.bc(4,"div",2),b.bc(5,"div",3),b.bc(6,"label"),b.Mc(7,"Nombre"),b.ac(),b.bc(8,"div",4),b.Mc(9),b.ac(),b.ac(),b.bc(10,"div",3),b.bc(11,"label"),b.Mc(12,"Apellido"),b.ac(),b.bc(13,"div",4),b.Mc(14),b.ac(),b.ac(),b.bc(15,"div",3),b.bc(16,"label"),b.Mc(17,"Correo electr\xf3nico"),b.ac(),b.bc(18,"div",4),b.Mc(19),b.ac(),b.ac(),b.bc(20,"div",3),b.bc(21,"label"),b.Mc(22,"Empresa"),b.ac(),b.bc(23,"div",4),b.Mc(24),b.ac(),b.ac(),b.ac(),b.ac(),b.bc(25,"div",5),b.bc(26,"button",6),b.ic("click",(function(){return t.closeDialog()})),b.Mc(27,"Salir"),b.ac(),b.ac(),b.ac()),2&e&&(b.Jb(9),b.Nc(t.user.name),b.Jb(5),b.Nc(t.user.lastName),b.Jb(5),b.Nc(t.user.email),b.Jb(5),b.Nc(t.user.company.name))},encapsulation:2}),e})();var N=i("oOf3");const E=function(e){return{userId:e}};function F(e,t){if(1&e){const e=b.cc();b.bc(0,"tr"),b.bc(1,"td"),b.Mc(2),b.ac(),b.bc(3,"td"),b.Mc(4),b.ac(),b.bc(5,"td"),b.Mc(6),b.ac(),b.bc(7,"td"),b.bc(8,"i",12),b.ic("click",(function(){b.Dc(e);const i=t.$implicit;return b.mc().viewDetail(i)})),b.ac(),b.Wb(9,"i",13),b.bc(10,"i",14),b.ic("click",(function(){b.Dc(e);const i=t.$implicit;return b.mc().delete(i.id)})),b.ac(),b.ac(),b.ac()}if(2&e){const e=t.$implicit;b.Jb(2),b.Nc(e.name),b.Jb(2),b.Nc(e.lastName),b.Jb(2),b.Nc(null==e.company?null:e.company.name),b.Jb(3),b.uc("queryParams",b.xc(4,E,e.id))}}function A(e,t){1&e&&b.Wb(0,"app-img-loading")}const J=function(e){return{itemsPerPage:10,currentPage:e}},R=[{path:"",component:r.a,children:[{path:"",component:(()=>{class e{constructor(e,t,i){this._user=e,this._alert=t,this.dialog=i,this.users=[],this.originalUsers=[],this.email="",this.p=1,this.isLoading=!1}ngOnInit(){this.getUsers()}getUsers(){this.isLoading=!0,this._user.getAll().subscribe(e=>{this.users=e,this.originalUsers=e,this.isLoading=!1},()=>{this._alert.error("Se ha presentado un error"),this.isLoading=!1})}filter(){this.users=0!==this.email.length?this.users.filter(e=>{if(e.email)return e.email.includes(this.email)}):this.originalUsers}delete(e){this._alert.confirmDelete().then(t=>{t.isConfirmed&&this._user.deleteById(e).subscribe(()=>{this.users=this.users.filter(t=>t.id!==e),this._alert.succes("Usuario ha sido eliminado con \xe9xito")},e=>{this._alert.error(e.error.Message)})})}downloadExcel(){const e=this.users.map(e=>({Nombre:e.name,Apellido:e.lastName,Empresa:e.company.name}));P.a.convertArrayToFile(e,"Usuarios")}viewDetail(e){const t=new U.e;t.data=e,this.dialog.open(L,t)}clearFilter(){this.email="",this.users=this.originalUsers}}return e.\u0275fac=function(t){return new(t||e)(b.Vb(m),b.Vb(f.a),b.Vb(U.b))},e.\u0275cmp=b.Pb({type:e,selectors:[["app-list-user"]],decls:28,vars:8,consts:[["id","container__content"],[1,"container-filter"],["type","text","placeholder","Correo electronico...",1,"form-control",3,"ngModel","ngModelChange","keyup"],["type","button",1,"btn","btn-danger",3,"click"],[1,"btn","btn-primary",3,"click"],["routerLink","/MasterUsers/form",1,"btn-add","btn-info"],[1,"fas","fa-plus"],[1,"table","table-striped"],[4,"ngFor","ngForOf"],[1,"paginationContainer"],[3,"pageChange"],[4,"ngIf"],["title","M\xe1s informaci\xf3n",1,"fas","fa-info-circle","text-info",3,"click"],["title","Modificar","routerLink","/MasterUsers/form",1,"fas","fa-edit","text-warning",3,"queryParams"],["title","Eliminar",1,"fas","fa-trash-alt","text-danger",3,"click"]],template:function(e,t){1&e&&(b.bc(0,"div",0),b.bc(1,"h1"),b.Mc(2,"Usuarios"),b.ac(),b.bc(3,"div",1),b.bc(4,"input",2),b.ic("ngModelChange",(function(e){return t.email=e}))("keyup",(function(){return t.filter()})),b.ac(),b.bc(5,"button",3),b.ic("click",(function(){return t.clearFilter()})),b.Mc(6," Borrar filtro "),b.ac(),b.bc(7,"button",4),b.ic("click",(function(){return t.downloadExcel()})),b.Mc(8," Descargar Excel "),b.ac(),b.ac(),b.bc(9,"button",5),b.Wb(10,"i",6),b.ac(),b.bc(11,"table",7),b.bc(12,"thead"),b.bc(13,"tr"),b.bc(14,"th"),b.Mc(15,"Nombre"),b.ac(),b.bc(16,"th"),b.Mc(17,"Apellido"),b.ac(),b.bc(18,"th"),b.Mc(19,"Empresa"),b.ac(),b.bc(20,"th"),b.Mc(21,"Acciones"),b.ac(),b.ac(),b.ac(),b.bc(22,"tbody"),b.Lc(23,F,11,6,"tr",8),b.nc(24,"paginate"),b.ac(),b.ac(),b.bc(25,"div",9),b.bc(26,"pagination-controls",10),b.ic("pageChange",(function(e){return t.p=e})),b.ac(),b.ac(),b.ac(),b.Lc(27,A,1,0,"app-img-loading",11)),2&e&&(b.Jb(4),b.uc("ngModel",t.email),b.Jb(19),b.uc("ngForOf",b.pc(24,3,t.users,b.xc(6,J,t.p))),b.Jb(4),b.uc("ngIf",t.isLoading))},directives:[o.c,o.q,o.t,n.c,c.n,N.c,c.o,_.a],pipes:[N.b],styles:["i[_ngcontent-%COMP%]{margin:0 3px;cursor:pointer}.col-number[_ngcontent-%COMP%]{max-width:50px;width:50px}table[_ngcontent-%COMP%]{cursor:pointer}.container-filter[_ngcontent-%COMP%]{display:flex;flex-direction:row;margin-bottom:30px}.container-filter[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:150px;cursor:pointer;margin-left:10px}.btn-add[_ngcontent-%COMP%]{border-radius:50%;width:50px;height:50px;cursor:pointer;position:relative;left:93%;margin-bottom:20px;top:15px;outline:none;text-align:center;font-size:24px;border:none;z-index:55}#container__content[_ngcontent-%COMP%]{transition:margin-left 1s;padding:20px 50px;margin-left:250px}@media only screen and (max-width:600px){.col-mobile-hide[_ngcontent-%COMP%]{display:none}.btn-add[_ngcontent-%COMP%]{left:80vw}}"]}),e})()},{path:"form",component:O}]}];let k=(()=>{class e{}return e.\u0275mod=b.Tb({type:e}),e.\u0275inj=b.Sb({factory:function(t){return new(t||e)},imports:[[n.f.forChild(R)],n.f]}),e})();var V=i("Z/wE"),D=i("bTqV");let z=(()=>{class e{}return e.\u0275mod=b.Tb({type:e}),e.\u0275inj=b.Sb({factory:function(t){return new(t||e)},providers:[m],imports:[[c.c,V.a,o.w,o.l,k,M.c,D.b,U.g]]}),e})()},aIEI:function(e,t,i){"use strict";i.d(t,"a",(function(){return c}));const c="Se ha presentado un error. Intente en otra ocasi\xf3n"},wnuP:function(e,t,i){"use strict";i.d(t,"a",(function(){return c}));const c={website:/^(https?|ftp):\/\/[^\s/$.?#].[^\s]*$/,uppercase:/[A-Z]/g,email:/^[a-zA-Z0-9_.+-]+@[a-zA-Z-]+\.[a-zA-Z]{2,3}$/,letters:/[A-z]/g,numbers:/[0-9]/g}}}]);